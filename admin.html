<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Clube de Teatro</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="caras.png">
    <!-- Styles -->
    <link rel="stylesheet" href="admin-styles.css">
    <!-- QR Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* RBAC Styles & Layout Fixes - Essential for Operator/Porteiro feel */
        body.role-operator .rbac-admin-only,
        body.role-porteiro .rbac-admin-only,
        body.role-operator .app-sidebar,
        body.role-porteiro .app-sidebar {
            display: none !important;
        }

        body.role-operator .app-layout,
        body.role-porteiro .app-layout {
            grid-template-columns: 1fr !important;
        }

        body.role-operator .app-main,
        body.role-porteiro .app-main {
            padding-left: 0 !important;
            width: 100% !important;
        }

        /* Calc Styles Pro */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .calc-btn {
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calc-btn:hover {
            background: #f8fafc;
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .calc-display {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 5px;
            border: 1px solid #e2e8f0;
        }

        .status-check-in {
            background: #dcfce7;
            color: #15803d;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.75rem;
        }

        /* --- MOBILE OPTIMIZATIONS --- */
        @media (max-width: 768px) {
            .app-layout {
                grid-template-columns: 1fr !important;
            }

            .top-bar {
                padding: 0 15px;
            }

            .content-scroll-area {
                padding: 15px;
            }

            .page-title {
                font-size: 1rem;
            }

            /* Dashboard Widgets */
            .dashboard-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            /* Porteiro Mobile */
            .porteiro-grid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }

            #porteiroReader {
                width: 100% !important;
                max-width: 350px;
                margin: 0 auto;
            }

            .porteiro-form-box {
                padding: 15px !important;
            }

            #porteiroSearchInput {
                font-size: 1.1rem !important;
                padding: 15px !important;
            }

            /* POS Mobile */
            .pos-card {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 15px !important;
            }

            .pos-card-right {
                width: 100%;
                margin-left: 0 !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
            }

            /* Modals & Calc Mobile */
            .modal-container {
                width: 95% !important;
                max-height: 95vh !important;
            }

            .calculator-grid button {
                padding: 15px !important;
                font-size: 1.2rem !important;
            }

            #calcInputDisplay {
                font-size: 2rem !important;
            }

            #calcResultDisplay {
                font-size: 3rem !important;
            }

            .user-profile span {
                display: none;
                /* Hide email on mobile top bar */
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script src="firebase-config.js"></script>
</head>

<body>
    <!-- Theme Initializer -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <!-- ============================================ -->
    <!-- AUTH SCREEN -->
    <!-- ============================================ -->
    <div id="loginSection" class="auth-container">
        <div class="auth-box">
            <h1 class="auth-title">Painel de Controlo</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" required placeholder="admin@escola.pt">
                </div>
                <div class="form-group">
                    <label class="form-label">Palavra-passe</label>
                    <input type="password" id="password" class="form-input" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="handleForgotPassword(event)"
                        style="font-size: 0.85rem; color: var(--color-primary); text-decoration: none;">Esqueci-me da
                        palavra-passe</a>
                </div>
                <p id="loginError"
                    style="color: var(--color-error); margin-top: 10px; font-size: 0.9rem; text-align: center;"></p>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- APP DASHBOARD -->
    <!-- ============================================ -->
    <div id="adminDashboard" class="app-layout" style="display: none;">

        <!-- SIDEBAR -->
        <aside class="app-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <span class="brand-title">üé≠ Painel de Admin</span>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="dashboard">
                    üìä Dashboard
                </button>
                <button class="nav-item" data-section="pecas">
                    üé¨ Pe√ßas
                </button>
                <button class="nav-item" data-section="membros">
                    üë• Membros
                </button>
                <button class="nav-item" data-section="pos">
                    üí∂ Bilheteira (POS)
                </button>
                <button class="nav-item" data-section="config">
                    ‚öôÔ∏è Configura√ß√µes
                </button>
            </nav>

            <div class="sidebar-footer">
                <button onclick="logout()" class="nav-item" style="color: #fda4af;">
                    üö™ Terminar Sess√£o
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="app-main">
            <div class="top-bar">
                <h2 class="page-title" id="pageTitleDisplay">Dashboard</h2>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <button onclick="toggleTheme()" class="btn-icon" id="themeToggleBtn" title="Alterar Tema"
                        style="background:none; border:none; font-size:1.4rem; padding:0;">üåì</button>
                    <div class="user-profile">
                        <span id="userEmail">admin@user.com</span>
                        <div class="btn-icon" style="background:#e2e8f0;">üë§</div>
                    </div>
                </div>
            </div>

            <!-- Scrollable Area -->
            <div class="content-scroll-area" id="mainContent">

                <!-- SECTION: DASHBOARD -->
                <section id="dashboardSection" class="admin-section">
                    <div class="dashboard-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-bottom: 32px;">
                        <div class="stat-widget">
                            <div class="stat-icon">üé≠</div>
                            <div>
                                <div class="stat-value" id="totalPecas">-</div>
                                <div class="stat-label">Pe√ßas Totais</div>
                            </div>
                        </div>
                        <div class="stat-widget">
                            <div class="stat-icon">üë•</div>
                            <div>
                                <div class="stat-value" id="totalMembros">-</div>
                                <div class="stat-label">Membros</div>
                            </div>
                        </div>
                        <div class="stat-widget">
                            <div class="stat-icon">üéüÔ∏è</div>
                            <div>
                                <div class="stat-value" id="totalReservas">-</div>
                                <div class="stat-label">Reservas</div>
                            </div>
                        </div>
                        <div class="stat-widget">
                            <div class="stat-icon">üí∞</div>
                            <div>
                                <div class="stat-value" id="totalPagos" style="color:#16a34a;">-</div>
                                <div class="stat-label">Pagamentos Recebidos</div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="liveStatusWidget">
                        <h3 style="margin-bottom: 10px;">Estado do Site</h3>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span id="statusLabel" style="font-weight: 700; font-size: 1.1rem;">Verificando...</span>
                        </div>
                        <p id="statusDescription" style="color: var(--color-text-muted); margin-top: 5px;"></p>
                    </div>

                    <div style="margin-top: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div class="card" style="border-left: 5px solid #16a34a; cursor: pointer;"
                            onclick="showSection('pos')">
                            <h3>‚ö° Bilheteira R√°pida</h3>
                            <p style="color: var(--color-text-muted); font-size: 0.9rem;">Entrada de visitantes e
                                recebimento de pagamentos em dinheiro.</p>
                            <button class="btn btn-primary"
                                style="margin-top: 15px; width: 100%; background: #16a34a; border: none;">Abrir POS
                                üí∂</button>
                        </div>
                        <div class="card" style="border-left: 5px solid #3b82f6; cursor: pointer;"
                            onclick="showAllReservations()">
                            <h3>üìã Lista de Reservas</h3>
                            <p style="color: var(--color-text-muted); font-size: 0.9rem;">Visualiza√ß√£o detalhada e
                                exporta√ß√£o de todos os bilhetes.</p>
                            <button class="btn btn-primary"
                                style="margin-top: 15px; width: 100%; background: #3b82f6; border: none;">Ver Todas as
                                Reservas</button>
                        </div>
                    </div>
                </section>

                <!-- SECTION: POS (Point of Sale) -->
                <section id="posSection" class="admin-section">
                    <div class="pos-layout-grid">

                        <!-- Left Panel: Search & Pending List -->
                        <div class="pos-main-panel">
                            <!-- Search Header -->
                            <div
                                style="padding: 25px; background: white; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; gap: 15px;">
                                <div style="position: relative; flex: 1;">
                                    <span
                                        style="position: absolute; left: 15px; top: 12px; font-size: 1.2rem; color: #94a3b8;">üîç</span>
                                    <input type="text" id="posSearchInput"
                                        placeholder="Pesquisar visitante ou c√≥digo..."
                                        style="width: 100%; padding: 12px 15px 12px 45px; font-size: 1rem; border-radius: 10px; border: 1px solid #cbd5e1; outline: none; transition: all 0.2s;">
                                </div>
                                <button onclick="showManualPOSReserva()" class="btn"
                                    style="background: #3b82f6; color: white; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0; box-shadow: 0 4px 10px rgba(59,130,246,0.3);"
                                    title="Nova Reserva Manual (POS)">
                                    +
                                </button>
                            </div>

                            <!-- List Area -->
                            <div style="flex: 1; overflow-y: auto; padding: 20px;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h3 style="margin: 0; font-family: 'Outfit'; color: #1e293b;">‚è≥ Bilhetes a Cobrar
                                    </h3>
                                    <span id="posPendingCount"
                                        style="background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700;">--</span>
                                </div>
                                <div id="posPendingList" style="display: flex; flex-direction: column; gap: 10px;">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>

                        <!-- Right Sidebar: Calculator & Totals -->
                        <div class="pos-sidebar-panel">
                            <!-- Daily Total Header -->
                            <div class="pos-sidebar-header">
                                <div class="pos-sidebar-label">ARRECADADO HOJE</div>
                                <div id="posDailyTotal" class="pos-sidebar-value">0.00‚Ç¨</div>
                            </div>

                            <!-- Calculator Display -->
                            <div class="pos-calc-display">
                                <div class="pos-calc-label">Total a Pagar</div>
                                <input type="number" id="calcTotalInput" step="0.01" value="0.00"
                                    class="pos-calc-total-input">

                                <div class="pos-calc-label-accent">Recebido</div>
                                <div id="calcInputDisplay" class="pos-calc-received">0.00‚Ç¨</div>

                                <div class="pos-calc-divider"></div>

                                <div class="pos-calc-label-success">Troco</div>
                                <div id="calcResultDisplay" class="pos-calc-change">0.00‚Ç¨</div>
                            </div>

                            <!-- Numerical Keypad -->
                            <div class="pos-keypad-container">
                                <!-- Quick Cash -->
                                <div class="pos-quick-cash">
                                    <button onclick="setQuickCash(5)" class="btn"
                                        style="background: #1e293b; color: white; padding: 12px 2px; font-weight: 800; border: 1px solid rgba(255,255,255,0.1);">5‚Ç¨</button>
                                    <button onclick="setQuickCash(10)" class="btn"
                                        style="background: #1e293b; color: white; padding: 12px 2px; font-weight: 800; border: 1px solid rgba(255,255,255,0.1);">10‚Ç¨</button>
                                    <button onclick="setQuickCash(20)" class="btn"
                                        style="background: #1e293b; color: white; padding: 12px 2px; font-weight: 800; border: 1px solid rgba(255,255,255,0.1);">20‚Ç¨</button>
                                    <button onclick="setQuickCash(50)" class="btn"
                                        style="background: #1e293b; color: white; padding: 12px 2px; font-weight: 800; border: 1px solid rgba(255,255,255,0.1);">50‚Ç¨</button>
                                </div>

                                <div class="pos-keypad-grid">
                                    <button onclick="addToCalc('7')">7</button>
                                    <button onclick="addToCalc('8')">8</button>
                                    <button onclick="addToCalc('9')">9</button>
                                    <button onclick="addToCalc('4')">4</button>
                                    <button onclick="addToCalc('5')">5</button>
                                    <button onclick="addToCalc('6')">6</button>
                                    <button onclick="addToCalc('1')">1</button>
                                    <button onclick="addToCalc('2')">2</button>
                                    <button onclick="addToCalc('3')">3</button>
                                    <button onclick="addToCalc('.')">.</button>
                                    <button onclick="addToCalc('0')">0</button>
                                    <button onclick="clearCalc()" class="btn-clear">C</button>
                                </div>

                                <button onclick="confirmarPagamentoPOS()" class="btn-pos-confirm">
                                    CONFIRMAR ‚úÖ
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: PORTEIRO (Entry Control) -->
                <section id="porteiroSection" class="admin-section" style="display: none;">
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <div class="card"
                            style="background: #0f172a; color: white; padding: 40px; border-radius: 20px; overflow: hidden; position: relative;">
                            <!-- Deco -->
                            <div
                                style="position: absolute; top: -20px; right: -20px; font-size: 8rem; opacity: 0.1; transform: rotate(15deg);">
                                üé´</div>

                            <div style="text-align: center; margin-bottom: 25px; position: relative; z-index: 1;">
                                <h1
                                    style="font-family: 'Outfit', sans-serif; font-size: 2.2rem; margin-bottom: 5px; color: white;">
                                    üö™ Controlo de Porteiro</h1>
                                <p style="opacity: 0.8;">Valida√ß√£o profissional de bilhetes e controlo de lota√ß√£o</p>
                            </div>

                            <div class="porteiro-grid"
                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; position: relative; z-index: 1;">
                                <!-- QR Scanner Box -->
                                <div
                                    style="background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 15px; padding: 15px; text-align: center;">
                                    <div id="porteiroReader"
                                        style="width: 100%; border-radius: 10px; overflow: hidden; background: black;">
                                    </div>
                                    <div style="margin-top: 15px;">
                                        <button onclick="startScanner()" id="btnStartScan" class="btn"
                                            style="background: var(--color-primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%;">
                                            üì∑ Iniciar Scanner
                                        </button>
                                    </div>
                                </div>

                                <!-- Manual Input Box -->
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="porteiro-form-box"
                                        style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                                        <label
                                            style="display: block; font-size: 0.85rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 10px;">Valida√ß√£o
                                            Manual</label>
                                        <input type="text" id="porteiroSearchInput"
                                            placeholder="Introduz o C√≥digo (ex: TEATRO-ABC)..."
                                            style="width: 100%; padding: 18px 20px; font-size: 1.2rem; border-radius: 12px; border: none; outline: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); background: white; color: #1e293b; text-align: center; text-transform: uppercase; font-weight: 800;">
                                        <button onclick="validarPorCodigoManual()" class="btn"
                                            style="width:100%; margin-top: 15px; background: #3b82f6; color: white; border: none; padding: 15px; font-weight: 800; border-radius: 10px;">Validar
                                            Agora ‚úÖ</button>
                                    </div>

                                    <div id="porteiroScanResult" class="fade-in"
                                        style="display:none; padding: 20px; border-radius: 15px; text-align: center; font-weight: 700;">
                                        <!-- Feedback here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                                <h3 style="margin: 0;">üë• Lista de Entradas (Pendente)</h3>
                                <div style="background: #f1f5f9; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; color: #64748b; font-weight: 600;"
                                    id="porteiroStats">
                                    A carregar...
                                </div>
                            </div>
                            <div id="porteiroList" style="display: flex; flex-direction: column; gap: 12px;">
                                <!-- Porteiro items injected via JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: PE√áAS -->
                <section id="pecasSection" class="admin-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3>Gest√£o de Pe√ßas</h3>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="showAddPecaForm()" class="btn btn-primary rbac-admin-only">+ Nova
                                Pe√ßa</button>
                            <button onclick="showAllReservations()" class="btn btn-outline">üìã Ver Todas as
                                Reservas</button>
                        </div>
                    </div>
                    <div id="pecasList" class="data-grid">
                        <!-- Pe√ßas injetadas via JS -->
                    </div>
                </section>

                <!-- SECTION: MEMBROS -->
                <section id="membrosSection" class="admin-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3>Equipa & Elenco</h3>
                        <button onclick="showAddMembroForm()" class="btn btn-primary rbac-admin-only">+ Novo
                            Membro</button>
                    </div>
                    <div id="membrosList" class="data-grid">
                        <!-- Membros injetados via JS -->
                    </div>
                </section>

                <!-- SECTION: CONFIG -->
                <section id="configSection" class="admin-section" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; align-items: start;">
                        <!-- Site Settings -->
                        <div class="card">
                            <h3 style="margin-bottom: 24px;">Configura√ß√µes Gerais</h3>
                            <form id="configForm">
                                <div class="form-group">
                                    <label class="form-label">Nome do Clube</label>
                                    <input type="text" id="configNomeClube" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nome da Escola</label>
                                    <input type="text" id="configEscola" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email de Contacto</label>
                                    <input type="email" id="configEmail" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hor√°rio</label>
                                    <input type="text" id="configHorario" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Local de Pagamento (ex: PBX)</label>
                                    <input type="text" id="configLocalPagamento" class="form-input"
                                        placeholder="Ex: PBX">
                                    <small style="color:#64748b;">Instru√ß√£o para quem reserva bilhetes pagos.</small>
                                </div>
                                <div class="form-group"
                                    style="background: #f0f9ff; padding: 15px; border-radius: 10px; border: 1px solid #bae6fd; color: #1e293b;">
                                    <label class="form-label" style="color: #0369a1; font-weight: 800;">üí∞ Taxa
                                        Bilheteira (POS)</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="number" id="configTaxaPOS" class="form-input" step="0.01"
                                            value="0.00" style="flex: 1;">
                                        <span style="font-weight: 700; color: #0369a1;">‚Ç¨ / bilhete</span>
                                    </div>
                                    <small style="color:#0369a1; opacity: 0.8;">Valor a somar ao pre√ßo base em vendas
                                        manuais no POS.</small>
                                </div>
                                <div style="margin-top: 10px; text-align: right;">
                                    <button type="submit" class="btn btn-primary">Guardar Altera√ß√µes</button>
                                </div>
                            </form>
                        </div>

                        <!-- Admin Management -->
                        <div class="card">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>Gest√£o de Administradores</h3>
                                <button onclick="showAddAdminForm()" class="btn btn-outline btn-sm">+ Novo
                                    Admin</button>
                            </div>
                            <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-bottom: 20px;">
                                Apenas os emails nesta lista podem aceder a este painel.
                            </p>
                            <div id="adminsList" style="display: flex; flex-direction: column; gap: 12px;">
                                <!-- Admins injected via JS -->
                            </div>
                        </div>

                        <!-- Global Layout Editor -->
                        <div class="card" style="grid-column: 1 / -1;">
                            <h3 style="margin-bottom: 20px;">Layout Padr√£o da Sala</h3>
                            <p style="margin-bottom: 15px; color: var(--color-text-muted);">Define a disposi√ß√£o dos
                                lugares que ser√° usar como base para novas pe√ßas.</p>

                            <div id="globalLayoutRows"
                                style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid var(--color-border); padding: 15px; border-radius: 6px;">
                            </div>

                            <button type="button" onclick="addLayoutRow('globalLayoutRows')"
                                class="btn btn-outline btn-sm">+ Adicionar Fila</button>

                            <div style="text-align: right; margin-top: 20px;">
                                <button type="button" onclick="saveGlobalLayout()" class="btn btn-primary">Guardar
                                    Layout Padr√£o</button>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- MODALS -->
    <!-- ============================================ -->

    <!-- Modal Pe√ßa -->
    <div id="pecaForm" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="pecaFormTitle">Nova Pe√ßa</h3>
                <button onclick="closePecaForm()" class="btn-icon"
                    style="border:none; background:none; font-size:1.2rem;">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="pecaFormElement">
                    <input type="hidden" id="pecaId">

                    <div class="form-group">
                        <label class="form-label">Nome da Pe√ßa</label>
                        <input type="text" id="pecaNome" class="form-input" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Autor</label>
                            <input type="text" id="pecaAutor" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ano</label>
                            <input type="number" id="pecaAno" class="form-input" value="2025">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sinopse</label>
                        <textarea id="pecaSinopse" class="form-textarea" rows="4"></textarea>
                    </div>

                    <!-- Galeria de Conte√∫dos (P√≥s-Estreia) -->
                    <div class="card"
                        style="background:#f0f9ff; border: 1px solid #bae6fd; margin-top: 20px; color: #1e293b;">
                        <h4 style="margin-bottom: 10px; color: #0369a1;">üñºÔ∏è Galeria de Conte√∫dos (P√≥s-Estreia)</h4>
                        <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 15px;">
                            Estes conte√∫dos apenas aparecer√£o no site ap√≥s a pe√ßa estrear (Galeria de Recorda√ß√µes).
                        </p>

                        <div class="form-group">
                            <label class="form-label">URLs de Fotos (uma por linha)</label>
                            <textarea id="pecaGaleriaFotos" class="form-textarea" rows="3"
                                placeholder="https://exemplo.pt/imagem1.jpg&#10;https://exemplo.pt/imagem2.jpg"></textarea>

                            <div id="dropZoneGaleria"
                                style="border: 2px dashed #bae6fd; padding: 15px; text-align: center; border-radius: 8px; margin-top: 10px; background: white;">
                                <p id="dropTextGaleria" style="color: #64748b; font-size: 0.85rem;">üì∏ Arraste fotos
                                    para adicionar √† galeria</p>
                                <input type="file" id="pecaGaleriaFotosFile" accept="image/*" multiple
                                    style="display: none;">
                                <button type="button" onclick="document.getElementById('pecaGaleriaFotosFile').click()"
                                    class="btn btn-outline btn-sm" style="margin-top: 5px;">Selecionar Fotos</button>
                                <button type="button"
                                    onclick="document.getElementById('pecaGaleriaFotos').value = ''; updateGaleriaPreview(); showToast('Galeria limpa')"
                                    class="btn btn-sm"
                                    style="margin-top: 5px; background: #fee2e2; color: #b91c1c; border: none;">Limpar
                                    Tudo</button>
                            </div>
                            <div id="pecaGaleriaPreview"
                                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 15px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">URLs de V√≠deos - YouTube/Vimeo (uma por linha)</label>
                            <textarea id="pecaGaleriaVideos" class="form-textarea" rows="3"
                                placeholder="https://youtube.com/watch?v=..."></textarea>
                        </div>
                    </div>

                    <div class="card" style="background:var(--color-bg); border:none;">
                        <label class="form-label">Cartaz / Imagem</label>
                        <div id="dropZonePeca"
                            style="border: 2px dashed var(--color-border); padding: 20px; text-align: center; border-radius: 8px;">
                            <p id="dropText" style="color: var(--color-text-muted); font-size: 0.9rem;">Arrasta uma
                                imagem ou clica para selecionar</p>
                            <input type="file" id="pecaImagemFile" accept="image/*" style="display: none;">
                            <input type="hidden" id="pecaImagem">
                            <button type="button" onclick="document.getElementById('pecaImagemFile').click()"
                                class="btn btn-outline" style="margin-top: 10px;">Selecionar Ficheiro</button>
                            <p id="uploadProgress"
                                style="display: none; color: var(--color-primary); font-size: 0.8rem; margin-top: 5px;">
                            </p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="pecaEmCartaz">
                            <span>Definir como "Em Cartaz" (Destaque Principal)</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="pecaRascunho">
                            <span>üöß Rascunho (n√£o aparece no site p√∫blico)</span>
                        </label>
                    </div>


                    <!-- Bilheteira Section -->
                    <div class="card" style="background:var(--color-bg); border:none; margin-top: 20px;">
                        <div class="form-group" style="margin-bottom: 5px;">
                            <label class="form-label"
                                style="display: flex; align-items: center; gap: 10px; color: #1e293b;">
                                <input type="checkbox" id="pecaRequerBilhete" onchange="toggleBilheteiraConfig()">
                                <span style="font-weight: 700;">üéüÔ∏è Esta pe√ßa requer reserva de lugar</span>
                            </label>
                        </div>

                        <div id="reservasToggleContainer"
                            style="display: none; margin-left: 28px; margin-bottom: 15px;">
                            <label class="form-label"
                                style="display: flex; align-items: center; gap: 10px; color: #1e293b; font-size: 0.85rem;">
                                <input type="checkbox" id="pecaReservasAbertas" checked>
                                <span>‚úÖ Reservas Abertas (pode ser desativado para "brevemente")</span>
                            </label>
                        </div>

                        <div id="bilheteiraConfig"
                            style="display: none; margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid var(--color-primary); color: #1e293b;">
                            <h4 style="margin-bottom: 15px; color: #1e293b;">Configura√ß√£o de Bilheteira</h4>

                            <!-- Paid / Free Toggle -->
                            <div
                                style="background:#f0fdf4; border:1px solid #bbf7d0; border-radius:8px; padding:15px; margin-bottom:20px; color: #1e293b;">
                                <label class="form-label"
                                    style="display: flex; align-items: center; gap: 10px; margin-bottom:10px; color: #1e293b;">
                                    <input type="checkbox" id="pecaPaga" onchange="togglePrecoField()"
                                        style="width:18px;height:18px;">
                                    <span style="font-weight:600;">üí∞ Pe√ßa Paga (cobrar bilhete)</span>
                                </label>
                                <div id="precoField" style="display:none; margin-top:8px;">
                                    <label class="form-label" style="color: #1e293b;">Pre√ßo do Bilhete (‚Ç¨)</label>
                                    <input type="number" id="pecaPreco" class="form-input" value="2.50" min="0"
                                        step="0.01" style="max-width:160px;">
                                    <div style="margin-top:10px;">
                                        <label class="form-label" style="color: #1e293b;">Local de Pagamento Espec√≠fico
                                            (opcional)</label>
                                        <input type="text" id="pecaLocalPagamento" class="form-input"
                                            placeholder="Se vazio, usa o global">
                                    </div>
                                    <div style="margin-top:10px;">
                                        <label class="form-label" style="color: #1e293b;">Limite de Reserva (horas
                                            antes)</label>
                                        <input type="number" id="pecaLimiteHoras" class="form-input" value="24" min="0">
                                        <small style="color:#64748b;">Bloqueia reservas novas X horas antes de cada
                                            sess√£o.</small>
                                    </div>
                                    <small style="color:#64748b; margin-top:4px; display:block;">O pagamento √© feito em
                                        dinheiro f√≠sico.</small>
                                </div>
                                <p style="font-size:0.85rem; color:#16a34a; margin-top:6px;" id="msgGratis">‚ú® Entrada
                                    gratuita ‚Äî ainda gera bilhete com QR para controlo.</p>
                            </div>

                            <!-- Session Manager -->
                            <div class="form-group"
                                style="margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px;">
                                <label class="form-label" style="color: #1e293b;">Sess√µes (Datas e Hor√°rios)</label>
                                <div id="listaSessoes" style="display: grid; gap: 10px; margin-bottom: 10px;"></div>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <input type="datetime-local" id="novaSessaoData" class="form-input"
                                        style="width: auto;">
                                    <input type="text" id="novaSessaoLocal" class="form-input"
                                        placeholder="Local (ex: Audit√≥rio)" style="flex: 1;">
                                    <button type="button" onclick="adicionarSessao()" class="btn btn-outline btn-sm">‚ûï
                                        Adicionar</button>
                                </div>
                            </div>

                            <!-- Layout Editor Removed: Always using Global Layout -->
                            <input type="hidden" id="pecaLayout">

                            <div class="form-group">
                                <label class="form-label">Lugares gr√°tis por membro do elenco</label>
                                <input type="number" id="pecaQuotaElenco" class="form-input" value="2" min="0" max="10"
                                    style="max-width:120px;">
                            </div>

                            <div id="gerarLinksSection"
                                style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button type="button" onclick="gerarLinksElenco()" class="btn btn-primary">
                                        üîó Gerar Links para Elenco
                                    </button>
                                    <button type="button" onclick="showEmitirBilheteManual()" class="btn btn-outline">
                                        üéüÔ∏è Emitir Bilhete Manual
                                    </button>
                                </div>
                                <div id="linksElencoList" style="margin-top: 10px;"></div>
                            </div>

                            <!-- Sec√ß√£o de Turmas Convidadas (persistente) -->
                            <div id="gerarLinksTurmaSection"
                                style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                                <h5 style="margin-bottom: 12px; color: #0369a1;">üè´ Turmas Convidadas</h5>
                                <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 12px;">
                                    Cria links de reserva gratuita para turmas. Os links ficam guardados e persistem
                                    mesmo ao fechar o admin.
                                </p>
                                <div
                                    style="display: grid; grid-template-columns: 1fr 120px auto; gap: 8px; align-items: end; margin-bottom:12px;">
                                    <div>
                                        <label class="form-label" style="font-size:0.8rem;">Nome da Turma</label>
                                        <input type="text" id="turmaLabel" class="form-input" placeholder="Ex: 10¬∫D">
                                    </div>
                                    <div>
                                        <label class="form-label" style="font-size:0.8rem;">N¬∫ de Lugares</label>
                                        <input type="number" id="turmaBilhetes" class="form-input" value="30" min="1"
                                            max="200">
                                    </div>
                                    <button type="button" onclick="gerarLinkTurma()" class="btn btn-outline"
                                        style="border-color:#0369a1; color:#0369a1;">üîó Convidar</button>
                                </div>
                                <!-- List of saved turma tokens -->
                                <div id="linksTurmaList" style="margin-top: 10px;"></div>
                            </div>

                        </div>
                    </div>

                    <!-- Participa√ß√µes Section -->
                    <div id="participacoesSection"
                        style="display: none; margin-top: 30px; border-top: 1px solid var(--color-border); padding-top: 20px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4>Elenco & Equipa</h4>
                            <button type="button" onclick="showAddParticipacaoForm()" class="btn btn-outline btn-sm">+
                                Adicionar</button>
                        </div>
                        <div id="participacoesList">
                            <!-- Injected JS -->
                        </div>
                    </div>


                    <div class="modal-footer">
                        <button type="button" onclick="closePecaForm()" class="btn btn-outline">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Pe√ßa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Membro -->
    <div id="membroForm" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="membroFormTitle">Novo Membro</h3>
                <button onclick="closeMembroForm()" class="btn-icon"
                    style="border:none; background:none; font-size:1.2rem;">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="membroFormElement">
                    <input type="hidden" id="membroId">

                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" id="membroNome" class="form-input" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Tipo</label>
                            <select id="membroTipo" class="form-select">
                                <option value="aluno">Aluno</option>
                                <option value="professor">Professor / Encenador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fun√ß√£o Principal</label>
                            <input type="text" id="membroFuncao" class="form-input"
                                placeholder="Ex: Ator, Luminot√©cnico">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mini Biografia</label>
                        <textarea id="membroBio" class="form-textarea" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="membroAtivo" checked>
                            Membro Ativo
                        </label>
                    </div>

                    <div class="modal-footer">
                        <button type="button" onclick="closeMembroForm()" class="btn btn-outline">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Membro</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Participa√ß√£o -->
    <div id="participacaoModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Adicionar Participa√ß√£o</h3>
            </div>
            <div class="modal-body">
                <form id="participacaoForm">
                    <div class="form-group">
                        <label class="form-label">Membro</label>
                        <select id="participacaoMembro" class="form-select" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Papel / Fun√ß√£o na Pe√ßa</label>
                        <input type="text" id="participacaoFuncao" class="form-input" required placeholder="Ex: Romeu">
                    </div>
                    <div class="modal-footer">
                        <button type="button" onclick="closeParticipacaoModal()"
                            class="btn btn-outline">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Adicionar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Admin -->
    <div id="adminForm" class="modal-overlay">
        <div class="modal-container" style="max-width: 450px;">
            <div class="modal-header">
                <h3>Novo Administrador</h3>
                <button onclick="closeAdminForm()" class="btn-icon"
                    style="border:none; background:none; font-size:1.2rem;">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="adminFormElement">
                    <div class="form-group">
                        <label class="form-label">Nome</label>
                        <input type="text" id="adminNome" class="form-input" required
                            placeholder="Ex: Professor Rafael">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="adminEmail" class="form-input" required placeholder="email@escola.pt">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Palavra-passe Inicial</label>
                        <input type="password" id="adminPassword" class="form-input" required minlength="6">
                        <small style="color:var(--color-text-muted);">M√≠nimo 6 caracteres.</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√≠vel de Acesso</label>
                        <select id="adminRole" class="form-input">
                            <option value="operator">üõí Operador de Bilheteira (POS)</option>
                            <option value="porteiro">üö™ Porteiro (Check-in)</option>
                            <option value="admin">üõ°Ô∏è Admin Master (Acesso Total)</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" onclick="closeAdminForm()" class="btn btn-outline">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Criar Conta</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Generic Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay" style="z-index: 9999;">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmar A√ß√£o</h3>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" style="color: var(--color-text-muted); font-size: 1rem;">Tem a certeza?</p>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeConfirmModal(false)" class="btn btn-outline">Cancelar</button>
                <button type="button" id="confirmBtnAction" class="btn btn-danger">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"
        style="position: fixed; bottom: 20px; right: 20px; background: var(--color-primary); color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 9999;">
        A√ß√£o realizada com sucesso!
    </div>

    <!-- Modal Reserva Manual POS -->
    <div id="posManualModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h3>üéüÔ∏è Nova Venda Manual (POS)</h3>
                <button onclick="closePOSManualModal()" class="btn-icon"
                    style="border:none; background:none; font-size:1.2rem;">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="posManualForm">
                    <div class="form-group">
                        <label class="form-label">Escolher Pe√ßa</label>
                        <select id="posManualPeca" class="form-select" required onchange="updatePOSManualSessions()">
                            <option value="">Selecione uma pe√ßa...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sess√£o</label>
                        <select id="posManualSessao" class="form-select" required>
                            <option value="">Primeiro escolha a pe√ßa...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nome do Cliente</label>
                        <input type="text" id="posManualNome" class="form-input" placeholder="Ex: Cliente de Balc√£o"
                            required>
                    </div>

                    <div id="posManualSelectionInfo"
                        style="margin-top: 10px; font-size: 0.85rem; color: var(--color-primary); font-weight: 600;">
                        Nenhum lugar selecionado
                    </div>
                    <input type="hidden" id="posManualFila">
                    <input type="hidden" id="posManualLugar">

                    <div id="posManualSeatMap" style="margin-top: 5px;"></div>

                    <div id="posManualPrecoInfo"
                        style="background:#f8fafc; padding:15px; border-radius:10px; margin-top:10px; border:1px solid #e2e8f0;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <span>Pre√ßo Base:</span>
                            <span id="posManualPrecoBase">0.00‚Ç¨</span>
                        </div>
                        <div
                            style="display:flex; justify-content:space-between; margin-bottom:5px; color:#0369a1; font-weight:700;">
                            <span>Taxa POS (+):</span>
                            <span id="posManualTaxaPOS">0.00‚Ç¨</span>
                        </div>
                        <div
                            style="display:flex; justify-content:space-between; font-size:1.2rem; font-weight:900; color:#1e293b; border-top:1px solid #cbd5e1; padding-top:10px; margin-top:5px;">
                            <span>Total a Pagar:</span>
                            <span id="posManualTotal">0.00‚Ç¨</span>
                        </div>
                        <button type="button" onclick="bridgeManualToCalc()" class="btn btn-outline btn-sm"
                            style="width:100%; margin-top:10px; font-size:0.75rem; border-color: #cbd5e1; color:#64748b;">
                            üßÆ Calcular Troco
                        </button>
                    </div>

                    <div class="modal-footer" style="padding-top:20px;">
                        <button type="button" onclick="closePOSManualModal()" class="btn btn-outline">Cancelar</button>
                        <button type="submit" class="btn btn-primary" style="flex:1;">Confirmar Venda ‚úÖ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Calculadora Pro -->
    <div id="calculatorModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 450px; background: #0f172a; color: white;">
            <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1); padding: 20px;">
                <h3 style="color: white; font-family: 'Outfit'; margin: 0;">üñ© Calculadora de Trocos Pro</h3>
                <button onclick="closeCalculator()" class="btn-icon"
                    style="color: white; border: none; background: none; font-size: 1.5rem;">‚úï</button>
            </div>
            <div class="modal-body" style="padding: 25px;">
                <div
                    style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: right;">
                    <div style="font-size: 0.8rem; opacity: 0.6; text-transform: uppercase; font-weight: 700;">Total a
                        Pagar</div>
                    <input type="number" id="calcTotalInput" step="0.01"
                        style="background: transparent; border: none; font-size: 1.8rem; font-weight: 800; color: white; text-align: right; width: 100%; outline: none;"
                        oninput="updateCalcUI()">

                    <div
                        style="font-size: 0.8rem; opacity: 0.6; text-transform: uppercase; margin-top: 15px; font-weight: 700;">
                        Valor Recebido</div>
                    <div id="calcInputDisplay" style="font-size: 2.8rem; font-weight: 800; color: #3b82f6;">0.00‚Ç¨</div>

                    <div style="height: 2px; background: rgba(255,255,255,0.1); margin: 15px 0;"></div>

                    <div style="font-size: 1rem; opacity: 0.6; text-transform: uppercase; font-weight: 800;">Troco a
                        Devolver</div>
                    <div id="calcResultDisplay" style="font-size: 3.8rem; font-weight: 900; color: #10b981;">0.00‚Ç¨</div>
                </div>

                <!-- Bot√µes de Dinheiro R√°pido -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                    <button onclick="setQuickCash(5)" class="btn"
                        style="background: #1e293b; color: white; padding: 15px 5px; font-weight: 800; font-size: 1.2rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">5‚Ç¨</button>
                    <button onclick="setQuickCash(10)" class="btn"
                        style="background: #1e293b; color: white; padding: 15px 5px; font-weight: 800; font-size: 1.2rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">10‚Ç¨</button>
                    <button onclick="setQuickCash(20)" class="btn"
                        style="background: #1e293b; color: white; padding: 15px 5px; font-weight: 800; font-size: 1.2rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">20‚Ç¨</button>
                    <button onclick="setQuickCash(50)" class="btn"
                        style="background: #1e293b; color: white; padding: 15px 5px; font-weight: 800; font-size: 1.2rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">50‚Ç¨</button>
                </div>

                <div class="calculator-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <button onclick="addToCalc('7')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">7</button>
                    <button onclick="addToCalc('8')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">8</button>
                    <button onclick="addToCalc('9')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">9</button>
                    <button onclick="addToCalc('4')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">4</button>
                    <button onclick="addToCalc('5')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">5</button>
                    <button onclick="addToCalc('6')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">6</button>
                    <button onclick="addToCalc('1')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">1</button>
                    <button onclick="addToCalc('2')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">2</button>
                    <button onclick="addToCalc('3')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">3</button>
                    <button onclick="addToCalc('.')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">.</button>
                    <button onclick="addToCalc('0')" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">0</button>
                    <button onclick="clearCalc()" class="calc-btn"
                        style="padding: 20px; font-size: 1.5rem; font-weight: 700; border-radius: 10px; border: none; background: #ef4444; color: white;">C</button>
                </div>
            </div>
            <div class="modal-footer" style="padding: 20px; background: rgba(0,0,0,0.2); border-top: none;">
                <button onclick="confirmarPagamentoPOS()" class="btn btn-primary"
                    style="width: 100%; padding: 20px; font-size: 1.3rem; font-weight: 900; background: #16a34a; border: none; box-shadow: 0 10px 20px rgba(22,163,74,0.3);">CONFIRMAR
                    PAGAMENTO ‚úÖ</button>
            </div>
        </div>
    </div>

    <!-- Modal Reserva Manual (POS) -->
    <div id="manualReservaModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h3>üéüÔ∏è Nova Reserva Manual</h3>
                <button onclick="closeManualReservaModal()" class="btn-icon">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="manualReservaForm">
                    <div class="form-group">
                        <label class="form-label">Nome do Visitante</label>
                        <input type="text" id="manualReservaNome" class="form-input" required
                            placeholder="Ex: Jo√£o Silva">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Espet√°culo</label>
                        <select id="manualReservaPeca" class="form-select" required onchange="updateManualSessions()">
                            <option value="">Selecionar Pe√ßa...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sess√£o</label>
                        <select id="manualReservaSessao" class="form-select" required>
                            <option value="">Selecionar Sess√£o...</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">Fila</label>
                            <input type="text" id="manualReservaFila" class="form-input" placeholder="Ex: A" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lugar</label>
                            <input type="number" id="manualReservaLugar" class="form-input" placeholder="Ex: 5"
                                required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeManualReservaModal()" class="btn btn-outline">Cancelar</button>
                <button onclick="saveManualReserva()" class="btn btn-primary">Emitir Bilhete</button>
            </div>
        </div>
    </div>

    <script src="admin-tutorial.js"></script>
    <!-- Excel Export Library -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="admin.js"></script>
    <script>
        // Simple UI scripts just for the layout
        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            if (!t) return;

            t.textContent = msg;

            // Adjust colors based on type
            if (type === 'error' || type === 'danger') {
                t.style.background = '#ef4444';
            } else if (type === 'info') {
                t.style.background = '#3b82f6';
            } else {
                t.style.background = 'var(--color-primary)';
            }

            t.style.transform = 'translateY(0)';
            t.style.opacity = '1';
            setTimeout(() => {
                t.style.transform = 'translateY(100px)';
                t.style.opacity = '0';
            }, 4000);
        }

        // Global exposure for admin.js compatibility
        window.showToast = showToast; 
    </script>
    <!-- Modal Image Preview -->
    <div id="imagePreviewModal" class="modal-overlay" onclick="closeImagePreview()" style="z-index: 3000;">
        <div class="modal-container"
            style="max-width: 90%; background: none; box-shadow: none; display: flex; align-items: center; justify-content: center; position: relative;"
            onclick="event.stopPropagation()">
            <img id="previewFullImage" src=""
                style="max-width: 100%; max-height: 90vh; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 2px solid white;">
            <button onclick="closeImagePreview()" class="btn-icon"
                style="position: absolute; top: 10px; right: 10px; color: white; border:none; background:rgba(0,0,0,0.5); font-size:1.5rem; width:40px; height:40px; border-radius:50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">‚úï</button>
        </div>
    </div>

    <script src="admin.js"></script>
</body>

</html>